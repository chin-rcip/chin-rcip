<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

  {%- include head.html -%}

  <body>

    {%- include header.html -%}

    <main class="page-content {% if page.sidebar %}main-with-sidebar{% endif %}" aria-label="Content">
      {% if page.sidebar %}
        <div class="{% if page.sidebar %}column sidebar{% endif %}">
          <h3>{% if page.sidebar == "sps" %}Semantic Paths Specification
              {% elsif page.sidebar == "tm" %}Target Model{% endif %}
          </h3>
          <ul class="mainlist">
            {% for item in site.data.sidetoc[page.sidebar] %}
              {% assign item_url = "/collections-model" | append: item.url %}
              <li>
                <a href="{{ item_url }}" class="{% if item.url == page.url %}active{% endif %}">{{ item.title }}
                  <span class="tooltip">{{ item.title }}</span>
                </a>
                {% if item.subfolder[0] %}
                  <ul class="sublist" style="{% if item.url != page.url %}display:none{% endif %}">
                  {% for entry in item.subfolder %}
                    {% assign entry_url = "/collections-model" | append: entry.url %}
                    <li class="{{ entry.lang }}">
                      <a id="toc-{{ entry.hash }}" href="{{ entry_url }}" onclick="active(this)">{{ entry.page }}
                        <span class="tooltip">{{ entry.page }}</span>
                      </a>
                      
                      {% if entry.subsubfolder[0] %}
                        <ul class="subsublist" style="{% if item.url != page.url %}display:none{% endif %}">
                        {% for subentry in entry.subsubfolder %}
                          {% assign subentry_url = "/collections-model" | append: subentry.url %}
                          <li>
                            <a id="toc-{{ subentry.hash }}" href="{{ subentry_url }}" onclick="active(this)">{{ subentry.page }}
                              <span class="tooltip">{{ subentry.page }}</span>
                            </a>
                            
                          </li>
                        {% endfor %}
                        </ul>
                      {% endif %}
                    </li>
                  {% endfor %}
                  </ul>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
      
      <div class="{% if page.sidebar %}column content{% endif %}">
        <div class="
          {% if page.sidebar %}main-content
          {% else %}wrapper
          {% endif %}">
          {{ content }}
        </div>

        {%- include footer.html -%}
      </div>
    </main>

    <script type="text/javascript">
      function active(element) {
        var cur_active = document.getElementsByClassName("active");
        var i;
        for (i = 0; i < cur_active.length; i++) {
          cur_active[i].setAttribute("class", "");
        };
        element.setAttribute("class", "active");
      };

      function highlight() {
        var headers = $(".main-content :header"); // get all headers in the main-content
        var anchor = $(".sidebar a:visible")[3] // get the 4th <a> to get its offset top later.
        var x;
        for (x = 0; x < headers.length; x++) {
          var header_top = $(headers[x]).offset().top;
          
          if (header_top > 30){
            if (header_top < 250){
              var header_id = $(headers[x]).attr("id");
              // var toc_x = $("#toc-"+header_id);
            } else {
              var header_id = $(headers[x - 1]).attr("id");
              // var toc_x = $("#toc-"+header_id);
            }
            var toc_x = $("#toc-"+header_id);
            if (Boolean(header_id)) {
              $(".active").removeClass("active");
              toc_x.addClass("active");
              // scroll to active <a> of sidebar
              $(".sidebar").animate({
                scrollTop: toc_x.offset().top - $(anchor).offset().top}, 100);
              break
            } else { break }
            
          }

        }
      };


      $(document).ready(function() {
        // Hide all tooltips on window load
        $(".tooltip").hide();
        highlight();

        // dropdown menu toggle

        $(".has-dropdown").click(function(){
          var other_dropdown = $(".has-dropdown").not(this);
          other_dropdown.removeClass("visible");
          other_dropdown.find(".dropdown").removeClass("visible");
          // $(".has-dropdown,.dropdown").removeClass("visible");
          $(this).find(".dropdown").toggleClass("visible");
          $(this).toggleClass("visible");
        });

        // language buttons
        var lang_sect_id = $(".lang-section").attr("id");
        $("button#"+lang_sect_id).addClass("activate");
      });

      
      // click anywhere in the html to hide dropdown menu
      $(document).on("click", function(event){
        // console.log($(event.target))
        if (!$(event.target).hasClass("has-dropdown")){
          console.log(event.target);
          $(".has-dropdown,.dropdown").removeClass("visible");
        }
      });


      // switching language by clicking language button
      $(".lang-buttons>button").click(function(){
        $(this).siblings().removeClass("activate");
        $(this).addClass("activate");
        var lang = $(this).attr("id");
        $(".lang-section").hide();
        $(".sublist li").hide();
        $("div#"+lang).show();
        $(".sublist li."+lang).show();
      })

       // scroll sidebar and highlight corresponding headers
      $(".column.content").scroll(function(){
        highlight();
      });

      // tooltips  
      $(".sidebar a").on({
        mouseenter: function(){
          if ($(window).width() > 800){
            var top = $(this).offset().top + $(this).height();
            var left = $(".sidebar").width();
            var tooltip = $(this).children("span");
            // set tooltip top and left position
            tooltip.css({"left": left + 40, "top": top - 30});
            // console.log($(this).outerWidth(), $(this)[0].scrollWidth);
            // showing tooltip only if ".sidebar a" outerWidth < its scrollWidth
            if ($(this).outerWidth() + 0.5 < $(this)[0].scrollWidth){
              tooltip.show();
            }
          };
          
        },

        mouseleave: function(){
          var tooltip = $(this).children("span");
          tooltip.hide();
        }
      });
    </script>
    

  </body>

</html>